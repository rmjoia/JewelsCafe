<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="JewelsCafe.Views.MainPage"
             xmlns:model="clr-namespace:JewelsCafe.Models"
             xmlns:viewmodel="clr-namespace:JewelsCafe.ViewModels"
             x:DataType="viewmodel:CoffeeListViewModel"
             Title="{Binding Title}">

    <Grid ColumnDefinitions="*,*" ColumnSpacing="5" RowDefinitions="100, *, Auto" >

        <!-- Shopping Cart -->
        <!-- In a real world scenario, I would extract this as a component and reuse -->
        <Grid Grid.Row="0" Grid.ColumnSpan="3" Margin="10">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="160" />
                <ColumnDefinition Width="100" />
                <ColumnDefinition Width="110" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Label Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="2" Text="Items in Cart: " VerticalTextAlignment="Center" FontSize="Small" />
            <Label Grid.Column="1" Grid.Row="0" Text="{Binding CartCount}" VerticalTextAlignment="Center" HorizontalTextAlignment="End" FontSize="Default" FontAttributes="Bold" />

            <Label Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2" Text="Total: " VerticalTextAlignment="Center" FontSize="Small" />
            <Label Grid.Column="1" Grid.Row="1" Text="{Binding TotalAmount, StringFormat='{0:C2}'}" VerticalTextAlignment="Center" HorizontalTextAlignment="End"  FontSize="Default" FontAttributes="Bold"/>

            <ImageButton Grid.Column="2" Grid.RowSpan="2" Source="cart_icon.png" HorizontalOptions="End" VerticalOptions="Center" HeightRequest="80" WidthRequest="80"
                         Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:CoffeeListViewModel}}, Path=CheckOutCommand}" />
        </Grid>

        <!-- Coffee List View -->
        <!-- In a real world scenario, I would extract this as a component and reuse this list could also be templated
        Additionally, this could be extended with gestures to left and right to add to cart and remove to cart and pull down to refresh, from the api... 
        but was overkill for this CA and there's no requirement for an API with updates in real time... -->
        <CollectionView Grid.Row="1" Grid.ColumnSpan="2" ItemsSource="{Binding CoffeeList}" SelectionMode="None">

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="model:Beverage" >
                    <Frame HeightRequest="90">
                        <Grid ColumnDefinitions="60,180,40,60" >

                            <!-- 
                            Some function that would get an update of how many items are currently in the cart of this item 
                            Maybe I would have to use a message bus, or events, anyway, I think it wasn't a requirement and it's not a good idea to overcomplicate things -->

                            <Image Grid.Column="0" Source="{Binding Picture}" Aspect="AspectFit" />
                            <VerticalStackLayout Grid.Column="1" Padding="10" Spacing="5">
                                <Label LineBreakMode="WordWrap" Text="{Binding Name}" FontSize="Default" FontAttributes="Bold" />
                                <Label LineBreakMode="WordWrap" Text="{Binding Price, StringFormat='{0:C2}'}" FontSize="Caption" />
                            </VerticalStackLayout>
                            <HorizontalStackLayout Grid.Column="2">
                                <Button BackgroundColor="Green" Margin="0,0,0,5"
                                        IsEnabled="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:CoffeeListViewModel}}, Path=IsDoneLoading}"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:CoffeeListViewModel}}, Path=AddToCartCommand}"
                                        CommandParameter="{Binding Id}"
                                        Text="+"
                                        FontAttributes="Bold"/>
                            </HorizontalStackLayout>
                            <HorizontalStackLayout Grid.Column="3">
                                <Button BackgroundColor="Red" Margin="10,0,0,5" 
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:CoffeeListViewModel}}, Path=RemoveFromCartCommand}" 
                                        CommandParameter="{Binding Id}"
                                        Text="-"
                                        FontAttributes="Bold"/>
                            </HorizontalStackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

    </Grid>

</ContentPage>

